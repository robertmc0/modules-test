# StorageAccounts

This module deploys Microsoft.StorageAccount and child resources

## Parameters

| Name                                    | Type     | Required | Description                                                                                                                                                                                               |
| :-------------------------------------- | :------: | :------: | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `name`                                  | `string` | No       | Optional. Name of the Storage Account. Autogenerated with a unique string if not provided.                                                                                                                |
| `location`                              | `string` | No       | Optional. Location for all resources.                                                                                                                                                                     |
| `systemAssignedIdentity`                | `bool`   | No       | Optional. Enables system assigned managed identity on the resource.                                                                                                                                       |
| `userAssignedIdentities`                | `object` | No       | Optional. The ID(s) to assign to the resource.                                                                                                                                                            |
| `storageAccountKind`                    | `string` | No       | Optional. Type of Storage Account to create.                                                                                                                                                              |
| `storageAccountSku`                     | `string` | No       | Optional. Storage Account Sku Name.                                                                                                                                                                       |
| `storageAccountAccessTier`              | `string` | No       | Optional. Storage Account Access Tier.                                                                                                                                                                    |
| `azureFilesIdentityBasedAuthentication` | `object` | No       | Optional. Provides the identity based authentication settings for Azure Files.                                                                                                                            |
| `managementPolicyRules`                 | `array`  | No       | Optional. The Storage Account ManagementPolicies Rules.                                                                                                                                                   |
| `networkAcls`                           | `object` | No       | Optional. Networks ACLs, this value contains IPs to whitelist and/or Subnet information. For security reasons, it is recommended to set the DefaultAction Deny                                            |
| `requireInfrastructureEncryption`       | `bool`   | No       | Optional. A boolean indicating whether or not the service applies a secondary layer of encryption with platform managed keys for data at rest. For security reasons, it is recommended to set it to true. |
| `blobServices`                          | `object` | No       | Optional. Blob service and containers to deploy                                                                                                                                                           |
| `fileServices`                          | `object` | No       | Optional. File service and shares to deploy                                                                                                                                                               |
| `queueServices`                         | `object` | No       | Optional. Queue service and queues to create.                                                                                                                                                             |
| `tableServices`                         | `object` | No       | Optional. Table service and tables to create.                                                                                                                                                             |
| `allowBlobPublicAccess`                 | `bool`   | No       | Optional. Indicates whether public access is enabled for all blobs or containers in the storage account. For security reasons, it is recommended to set it to false.                                      |
| `minimumTlsVersion`                     | `string` | No       | Optional. Set the minimum TLS version on request to storage.                                                                                                                                              |
| `enableHierarchicalNamespace`           | `bool`   | No       | Optional. If true, enables Hierarchical Namespace for the storage account                                                                                                                                 |
| `diagnosticLogsRetentionInDays`         | `int`    | No       | Optional. Specifies the number of days that logs will be kept for; a value of 0 will retain data indefinitely.                                                                                            |
| `diagnosticStorageAccountId`            | `string` | No       | Optional. Resource ID of the diagnostic storage account.                                                                                                                                                  |
| `diagnosticWorkspaceId`                 | `string` | No       | Optional. Resource ID of the diagnostic log analytics workspace.                                                                                                                                          |
| `diagnosticEventHubAuthorizationRuleId` | `string` | No       | Optional. Resource ID of the diagnostic event hub authorization rule for the Event Hubs namespace in which the event hub should be created or streamed to.                                                |
| `diagnosticEventHubName`                | `string` | No       | Optional. Name of the diagnostic event hub within the namespace to which logs are streamed. Without this, an event hub is created for each log category.                                                  |
| `lock`                                  | `string` | No       | Optional. Specify the type of lock.                                                                                                                                                                       |
| `tags`                                  | `object` | No       | Optional. Tags of the resource.                                                                                                                                                                           |
| `basetime`                              | `string` | No       | Generated. Do not provide a value!.                                                                                                                                                                       |
| `publicNetworkAccess`                   | `string` | No       | Optional. Enable or disallow public network access to Storage Account..                                                                                                                                   |
| `supportsHttpsTrafficOnly`              | `bool`   | No       | Optional. Allows HTTPS traffic only to storage service if sets to true.                                                                                                                                   |
| `diagnosticMetricsToEnable`             | `array`  | No       | Optional. The name of metrics that will be streamed.                                                                                                                                                      |
| `diagnosticSettingsName`                | `string` | No       | Optional. The name of the diagnostic setting, if deployed.                                                                                                                                                |

## Outputs

| Name                      | Type   | Description                                                        |
| :------------------------ | :----: | :----------------------------------------------------------------- |
| resourceId                | string | The resource ID of the deployed storage account                    |
| name                      | string | The name of the deployed storage account                           |
| resourceGroupName         | string | The resource group of the deployed storage account                 |
| primaryBlobEndpoint       | string | The primary blob endpoint reference if blob services are deployed. |
| systemAssignedPrincipalId | string | The principal ID of the system assigned identity.                  |

## Examples

Please see the [Bicep Tests](test/main.test.bicep) file for examples.